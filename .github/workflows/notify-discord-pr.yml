on:
  pull_request:
    types: [ opened ]
  pull_request_review:
    types: [ submitted ]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Webhook, Skip if review is just a comment
        if: github.event.review.state != 'commented'
        run: |
          PR_URL="https://github.com/${{ github.repository }}/pull/${{ github.event.pull_request.number || github.event.pull_request_review.pull_request.number }}"
          AUTHOR="${{ github.event.pull_request.user.login || github.event.review.user.login }}"
          TITLE="${{ github.event.pull_request.title || github.event.pull_request_review.pull_request.title }}"
          REVIEW_STATE="${{ github.event.review.state || '' }}"

          CONTENT=""
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            CONTENT="ğŸ“Œ ìƒˆ PRì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\nğŸ”— ${PR_URL}\nğŸ“„ ì œëª©: ${TITLE}\nğŸ™‹ ì‘ì„±ì: ${AUTHOR}"
          elif [ "${{ github.event_name }}" = "pull_request_review" ]; then
            CONTENT="ğŸ” PRì— ë¦¬ë·°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (${REVIEW_STATE})\nğŸ”— ${PR_URL}\nğŸ™‹ ë¦¬ë·°ì–´: ${AUTHOR}"
          fi

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"${CONTENT}\"}" \
               ${{ secrets.DISCORD_WEBHOOK }}
